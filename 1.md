---
marp: true
theme: uncover
class: invert
title: Семинар № 1. Основы децентрализованных систем
author: Андрей Гулицкий <andrey@gulitsky.dev>, Павлов Антон <apaw92@gmail.com>
math: katex
---

<!-- header: Цикл семинаров «Децентрализованные системы и приложения» -->
<!-- footer: Докладчики: [Гулицкий А. Н.](mailto:andrey@gulitsky.dev), Павлов А. П. -->

![bg left:33%](https://i.imgur.com/b0Sz8cg.png)

Семинар № 1
# <!-- fit --> Основы децентрализованных систем

---

<!-- header: ""-->
<!-- footer: ""-->

## Содержание

1. Криптография;
2. P2P-сети (одноранговые сети);
3. Алгоримты консенсуса;
4. Темпоральная логика;
5. Основы блокчейна.

---

<!-- paginate: true -->
<!-- header: Криптография-->

## Протокол

> порядок действий, предпринимаемых двумя или более сторонами, предназначенный для решения определённой задачи.
>
> *Брюс Шнайер «Прикладная криптография»*

---

### Характеристики протокола

- Определённость;
- Согласие;
- Однозначность;
- Полнота.

---

## Криптографический протокол

> протокол, использующий криптографию.
>
> *Брюс Шнайер «Прикладная криптография»*

---

*Невозможно сделать или узнать больше, чем определено в криптографическом протоколе.*

---

## Криптографические примитивы

- Хэш-функция (**криптографическая**);
- Цифровая (электронная) подпись;
- *Симметричное и асимметричное шифрование*;
- *Функции формирования ключа (KDF);*
- *Криптографически стойкий генератор псевдослучайных чисел;*

---

### Криптографическая хэш-функция

![width:700px](https://i.imgur.com/CJddLH6.png)


---

#### Свойства хэш-функции

![](https://i.imgur.com/CcJWAWm.png)

---

##### Некоррелируемость (лавинный эффект)

![bg vertical](https://i.imgur.com/CJddLH6.png)
![bg](https://i.imgur.com/tEswWZR.png)

---

#### Хэш-функции

- Blake;
- SHA-3;
- SHA-2;
- *SHA-1*;
- *MD5*;
- ГОСТ 34.11-2018 «Стрибог».

---

![w:700](https://i.imgur.com/PCq4a2k.png)

[Атака нахождения коллизии алгоритма SHA-1](https://shattered.io)

---

### Электронная подпись

> информация в электронной форме, которая присоединена к другой информации в электронной форме (подписываемой информации) или иным образом связана с такой
> информацией и которая используется для определения лица, подписывающего информацию.
> 
> *Федеральный закон от 6 апреля 2011 г. N 63-ФЗ «Об электронной подписи»*

---

![](https://i.imgur.com/i56t4YB.png)

---

![](https://i.imgur.com/wdFWg6Y.png)

---
#### Принципы работы электронной подписи

- Аутентификация;
- Неотказуемость;
- Целостность.

--- 

#### Алгоритмы электронной подписи

- DSA;
- ECDSA;
- EdDSA;
- RSA;
- ГОСТ 34.10-2018.

---

### Дерево Меркла (хэшей)

![w:700](https://russianblogs.com/images/395/943b0a69d5666a2f324cf3483de5f9eb.JPEG)

---

### Фильтр Блума

Вероятностная структура данных, позволяющая проверить принадлежность элемента ко множеству. Допускает ложноположительные, но не ложноотрицательные срабатывания.

---

## Криптографические протоколы

- Банковские карты;
- SIM-карты.

--- 

## Проектирование криптографических протоколов

- Don't roll your own crypto;
  - Пользуйтесь хорошо известными, используемыми и проверенными на практике алгоритмами.

---

## Проектирование криптографических протоколов

- Не следует множить сущее без необходимости (бритва Оккама);
  - Любая система не безопасней её самого слабого элемента.

---

## Проектирование криптографических протоколов

- Не полагайтесь на безопасность через неясность.
  - «Если я скрою детали реализации протокола, он будет более безопасным»;
  - максима Шеннона (принцип Керкгоффса): злоумышленник знает всё о протоколе, кроме секретного ключа.

---

<!-- header: P2P-сети-->

## P2P - сети

> Никакой закон не может быть предписан относительно большой группе населения, которая (а) не поддерживает данный закон морально и (б) имеет в наличии легкие пути его пресечения.
>
> *Джон Перри Барлоу*

---

### Основные принципы
- Децентрализованность.

### Неосновные принципы
- Полносвязность;
- Анонимность;
- Самоорганизация;
- и пр.

---

### Реализация и использование P2P

- Приложения доставки контента на основе протокола Bittorrent и WebTorrent
- Приложения для обмена файлами: Napster, Gnutella, eMul ...
- Приложения для хранения файлов: IPFS, PAST ...
- Приложения для общения: Jami, Skype ...
- Приложения для торговли: Tradepal и приложения для мобильной коммерции
- Поисковые системы: FAROO, Chord ...

---

### Реализация и использование P2P
- Добровольный експлойт: BitCoin, Ethereum ...
- Ботнет: Storm и др..
- Анонимный интернет: Tor, I2P, Freenet ...
- Операционные системы: Artisoft LANtastic, Windows 10 - 11.
- Мультимедиа:  Peercasting и Osiris, а так же приложения на базе протоколов P2PTV и PDTP...

---

## DHT (Distributed Hash Tables)

- Автономность.
- Отказоустойчивость.
- Масштабируемость.

---

<style scoped>

img{
  height: 20%;
}
p{
  font-size: 20px; 
}
table {
    height: 20%;
    width: 100%;
    font-size: 20px;   
}
</style>

Таблица одноранговой маршрутизации для однорангового узла с GUID 0 (4-битный GUID)

Cell Index | Referenced GUID | GUID Distance
-----|------|:-----:
0 | 0 | 0 $(2^0)$
1 | 2 | 2 $(2^0)$
2 | 4 | 4 $(2^0)$
3 | 8 | 8 $(2^0)$

![width:300px height:300px](https://i.imgur.com/1IAWgu2.png)

---

Алгоритм добавления файла
![width:500px height:500px](https://i.imgur.com/wcccPSM.png)

---

### Протоколы и реализации DHT
Исходные: Chord, CAN, Tapestry и Pastry.

Остальные: Apache Cassandra, BATON Overlay, Koorde, Kademlia, Mainline, P-Grid, Riak, Tapestry, TomP2P, Voldemort.

---

<style scoped>
p{
  font-size: 20px; 
}
table {
    height: 20%;
    width: 100%;
    font-size: 20px;   
}

</style>

Chord (sub)| Kademlia (xor)
-----|------|


|Peer GUID|$2^0 = 1$|$2^1 = 2$|$2^2 = 4$|$2^3 = 8$|\| |Peer GUID|$2^0 = 1$|$2^1 = 2$|$2^2 = 4$|$2^3 = 8$|
-----|------|-----|-----|-----|-----|------|-----|-----|-----|-----|
|0|1|2|4|8|\||0|1|2|4|8|
|1|2|3|5|9|\||1|0|3|5|9|
|2|3|4|6|10|\||2|3|0|4|10|
|3|4|5|7|11|\||3|2|1|7|11|
|4|5|6|8|12|\||4|5|6|0|12|
|5|6|7|9|13|\||5|4|7|1|13|
|6|7|8|10|14|\||6|7|4|2|14|
|7|8|9|11|15|\||7|6|5|3|15|
|8|9|10|12|0|\||8|9|10|12|0|
|9|10|11|13|1|\||9|8|11|13|1|
|10|11|12|14|2|\||10|11|8|14|2|
|11|12|13|15|3|\||11|10|9|15|3|
|12|13|14|0|4|\||12|13|14|8|4|
|13|14|15|1|5|\||13|12|15|9|5|
|14|15|0|2|6|\||14|15|12|10|6|
|15|0|1|3|7|\||15|14|13|11|7|

---

<style scoped>
p{
  font-size: 20px; 
}

</style>
Таблицы одноранговой маршрутизации в P2P (4 бита)
![](https://i.imgur.com/wCQZqUp.png)

---

Протокол Kademlia содержит 4 типа сообщений:

1)	PING
2)	STORE
3)	FIND_VALUE
4)	FIND_NODE

---

### Безопасность

Основные виды атак на P2P сети:

1) Атака Сибиллы (Сивиллы) (Sybil attack)
2) Атака затмения (Eclipse Attack)

---

<!-- paginate: true -->
<!-- header: Алгоримты консенсуса-->

## Алгоримты консенсуса.

> Беда в том, что если я тебе не верю, то я не могу верить твоим словам о том, что тебе можно верить..
>
> *Доктор Грегори Хаус (т/с Доктор Хаус)*

---

### Задача византийских генералов

![width:1100px height:500px](https://bytwork.com/sites/default/files/inline/images/zadacha_vizantiyskih_generalov.png)


---

### Paxos

<style scoped>
p{
  font-size: 20px; 
}
</style>

Роли: Client, Proposer, Acceptor, Learner.
Кворум для 2N+1 узлов равен N+1.
Этапы: Prepare, Promise, Accept!, Accepted.

![](https://habrastorage.org/r/w1560/getpro/habr/post_images/7f1/284/535/7f1284535a2742ab25912c32338d4529.png)

---

### Raft

![](https://media.geeksforgeeks.org/wp-content/uploads/multiple-server-labelled-raft-visual.png)

---

### Proof of Work (PoW)

![width:700px height:500px](https://capital.com/files/glossary/-infographics-Proof-of-Work-PoW-.png)

---

### Proof of Stake (PoS)

![width:800px height:500px](https://i.imgur.com/k3p0Xqk.png)

---

<!-- paginate: true -->
<!-- header: Темпоральная логика и векторные часы-->

## Темпоральная логика и векторные часы.

> Совершенное познание необходимости устранило бы всякое "долженствование", - но и постигло бы необходимость "долженствования", как следствие незнания.
>
> *Фридрих Ницше*

---

### Операторы
1) Логические: ¬, ∧, ∨, →.

2) Модальные: Until (U), neXt (X), Release (R),  Future or Final (F), Globally (G), All (A), Exists (E).

---

<style scoped>
p{
  font-size: 20px; 
}
table {
    height: 20%;
    width: 100%;
    font-size: 20px;   
}
</style>

Модальные операторы
|Обозначение |	Описание|	Диаграмма|
|---|---|---|
|$pUq$|“когда-нибудь наступит утв. q, а до него все время будет утв. p”|![](https://upload.wikimedia.org/wikipedia/ru/timeline/96ym2ma4da996pj2mmo4c26k4miiki6.png)|
|$pRq$|“утв. q будет выполнено до тех пор пока не появится утв. p (включительно)”|![](https://upload.wikimedia.org/wikipedia/en/timeline/oqtxafksrgvoayz3qcho8bcds1vndjw.png)|
|$Xp$|“в следующий момент”|![](https://upload.wikimedia.org/wikipedia/ru/timeline/8901nb3rhw21hk6x6zffx95vgfvv1hl.png)|
|$Gp$|“всегда, повсюду”|![](https://upload.wikimedia.org/wikipedia/ru/timeline/d8ou6f0wq0oxtyj6mquvlesoeb9eu10.png)|
|$Fp$|“когда-нибудь в будущем”|![](https://upload.wikimedia.org/wikipedia/ru/timeline/8v3u2irdwzm1n407ug8ne1ysbzxio4d.png)|

---
<style scoped>
p{
  font-size: 20px; 
}
ul{
  font-size: 20px; 
}
</style>

###### Пример:
Пусть $p$ означает "Я люблю Машу", а $q$ "Я люблю Дашу". Тогда:
- $Fp$ - "Я когда-нибудь обязательно полюблю Машу";
- $Gq$ - "Я всегда буду любить Дашу";
- $G(¬p∨¬q)$ - "Я никогда не буду любить и Машу, и Дашу одновременно";
- $qUp$ - "В будущем я полюблю Машу, а до тех пор буду любить Дашу";
- $FGp$ - "Когда-нибудь я полюблю Машу навечно";
- $GFq$ - "Я буду бескончено влюбляться в Дашу".

---

<style scoped>
p{
  font-size: 20px; 
}
ul{
  font-size: 20px; 
}
</style>

### Векторные часы

Логические часы — это функция $C(e):E→R$ (из событий в числа) такая, что для любых двух событий e и f следующие утверждение действительно: если $e→f$ (e произошло-до f), то $C(e)<C(f)$.

Векторные часы — это функция $VC(e):E→R^n$ (из событий в вектор константного размера) такая, что для любых двух событий e и f следующие утверждения равносильны:
- $e→f$ (e произошло-до f)
- $VC(e)<VC(f)$ (все компоненты VC(e) меньше всех компонент VC(f))

---


![width:1100px height:550px](https://8thlight.com/blog/assets/posts/2013-10-04-synchronization-in-a-distributed-system/vc-example1-d34e3688946b4be742026c606847d63c50fff0e144acc996605de95e99d34c7d.png)

---

<!-- header: Основы блокчейна -->

## Блокчейн

> это цепочка блоков данных, каждый из которых ссылается на предыдущий.

---

### Связный список

![](https://upload.wikimedia.org/wikipedia/commons/thumb/9/9c/Single_linked_list.png/400px-Single_linked_list.png)
